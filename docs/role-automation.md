# План автоматизации ролей

## Цель

Мы хотим автоматизировать реакции на смены ролей в Azuriom (например, автодобавление/удаление whitelist, autoban) на основе гибкой конфигурации. Сейчас код содержит только заглушку-слушатель (`SocialProfileServiceProvider::registerRoleListener()`).

## Актуальные TODO (из service provider)

```php
// TODO:
// - Сделать конфигурацию переходов ролей наподобие:
//   [
//     ['from' => ['X'], 'to' => ['Y'], 'action' => 'whitelist_add'],
//     ['from' => ['*'], 'to' => ['Z'], 'action' => 'auto_ban'],
//     ['from' => ['Y'], 'to' => ['X'], 'action' => 'whitelist_remove'],
//   ]
// - Поддержать перечисление ID через запятую и wildcard '*'.
// - На основе конфигурации выполнять автоматизацию (вайтлист, бан и т. п.).
```

## План реализации

1. **Файл конфигурации.**
   Задаём переходы в `config/socialprofile_roles.php`, где:
   - `from` и `to` — массивы ID или `*`;
   - `action` — название действия (`whitelist_add`, `whitelist_remove`, `auto_ban` и т. п.);
   - `meta` — дополнительные данные (например, имя whitelist, причина бана).

2. **Логика наблюдателя.**
   Слушаем изменения ролей у пользователей (например, `User::updated` и `isDirty('role_id')`), подбираем подходящие переходы и отправляем задания.

3. **Обработчики действий.**
   Реализуем сервисы/джобы для каждого действия (работа со списками, банами и т. д.). Важно позволить проектам регистрировать свои обработчики.

4. **Редактирование переходов.**
   Конфигурация — простой массив с ID (можно хранить строку с запятыми и разбирать при загрузке). Пример:

   ```php
   [
       'from' => ['1', '2'],
       'to' => ['3'],
       'action' => 'whitelist_add',
       'meta' => ['list' => 'vip'],
   ]
   ```

5. **Тестирование.**
   - Unit: проверка сопоставления переходов и парсинга конфига.
   - Feature: эмуляция смены роли у пользователя.

Файл нужно обновить, когда дорожная карта будет реализована; сейчас он фиксирует ожидания и подсказки для будущей разработки.
